#!/sbin/openrc-run
description="Danted"
command="/usr/sbin/sockd"
supervisor="supervise-daemon"
depend() {
	need cloudflare-warp
}
start_pre() {
	ewaitfile 60 /sys/class/net/CloudflareWARP
	if [[ ! -f /etc/sockd.conf ]]; then
		echo "
internal: 0.0.0.0 port=1080
external: CloudflareWARP
clientmethod: none
socksmethod: none
client pass {
	from: 0.0.0.0/0 to: 0.0.0.0/0
}
socks pass {
	from: 0.0.0.0/0 to: 0.0.0.0/0
}
	" > /etc/sockd.conf
	fi
}
